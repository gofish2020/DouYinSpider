
# 爬取抖音个人主页视频下的评论

这里使用的 seleniue库，因为抖音直接访问url的方式爬取数据，需要对请求参数签名，但是我们不知道具体是怎么签名的，如果没有能力逆向出签名的js，那么直接调用接口的方式是行不通的，接口直接不返回结果。。所以没办法，直接用浏览器的方式，访问用户主页的url。基于渲染好的网页，从网页中获取数据。

seleniue库 本身就是用来做网页自动化测试的库，可以让你通过编写js代码来模拟用户查看网页的点击，下一页等等行为。当然你要对被测试网页的源码有点研究，js也要熟悉。

## 前置环境


- 去这里查看谷歌浏览器的版本
![](image-2.png)
![](image-3.png)

- 去该页面 https://googlechromelabs.github.io/chrome-for-testing/ 下载和当前的谷歌浏览器版本一致的 chromedrive（截图我的版本，找你自己的版本）
![](image.png)

-  解压缩zip
- 文件复制到 `/usr/local/bin` 目录下（同时修改为可执行 `chmod a+x chromedrive`）
- 因为我是mac直接运行下，发现是运行不起来的，需要安全性允许下
![](image-1.png)


记得将`myini.ini`中将`chromeDriverPath`修改为自己的路径
在谷歌浏览器中输入: `chrome://version`命令，将“个人资料路径“这个复制出来，修改 `myini.ini`文件中`userdatadir`的值为你自己的路径；(目的为了复用浏览器的历史数据，这样不用每次都登录。)

## 使用示例


- 运行程序 `./MedicalSpider`
- 此时会弹出谷歌浏览器出来，不用管；看程序命令行输出，会提示你 【请输入用户主页url:】
- 找一个自己喜欢看的个人主页，复制整个url，例如: https://www.douyin.com/user/MS4wLjABAAAAG0itb5W4abVyFGxSNlGkKvG20un-Ix4R2UfuJUeXHo0?vid=7375750907994197286
- 然后就等待即可（这时看下浏览器，如果需要登录，用app扫码登录，不然程序是不会爬取数据的），最终数据保存到在`data`文件夹下，子文件夹的名字是抖音号
- 爬取完成后，可以继续输入用户主页的url，继续爬取



## 为什么这么做？
用户个人主页，有反扒，使用 a_bogus 签名，找了一些别人逆向好的js，发现都不能用。所以选择直接用(selenium库 + chromedriver)模拟浏览器的方式，直接访问用户主页。整个页面上就有渲染好的`aweme_id`还有视频的url，可以直接爬取评论。

抖音现在的评论信息可以直接使用接口抓取，没有反扒的签名，所以可以直接调用接口。


## 代码基本逻辑

- 代码会启动一个谷歌浏览器，然后打开用户输入的链接，这个时候，如果抖音没有登录，代码中会死循环等待用户扫码登录自己的抖音账号；
- 然后代码会自动让浏览器向下滚动，一直到达整个视频瀑布流的底部，此时网页上就有了所有的视频；
- 提取网页中的视频的`a`链接，这个时候你可以选择下载视频，也可以获取的视频的id，调用评论接口获取评论信息